webpackJsonp([92],{PGDY:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("woOf"),o=a.n(s),r=a("Lna1"),i=a("P9l9"),n={data:function(){return{wheatDataList:[],readAudit:[],flourContainerList:[],wheatContainerList:[],dialogFormVisible:!1,formLabelWidth:"120px",stockForm:{},dataRule:{wheatDeviceId:[{required:!0,message:"必选",trigger:"click"}],startWeight:[{required:!0,message:"必填",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur"}],endWeight:[{required:!0,message:"必填",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur"}],inPortBatch:[{required:!0,message:"必填",trigger:"blur"},{max:10,message:"长度不能超过10",trigger:"blur"}]}}},mounted:function(){this.getFlourContainerList(),this.getWheatContainerList()},props:{isRedact:Boolean,inStorageState:String,order:Object},filters:{formatDate:function(t){return t&&t.length>10?t.substring(0,10):t}},methods:{getFlourContainerList:function(){var t=this;if(this.flourContainerList=[],void 0!==this.order&&void 0!==this.order.workShopName){var e={type:"holder_type",holder_type:"009",pageSize:9999,workShopName:this.order.workShopName,currPage:1};this.$http(""+i.c.CONTAINERLIST_API,"POST",e).then(function(e){var a=e.data;0===a.code?t.flourContainerList=a.page.list:t.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})}},getWheatContainerList:function(){var t=this;if(this.wheatContainerList=[],void 0!==this.order&&void 0!==this.order.workShopName){var e={type:"holder_type",holder_type:"002",pageSize:100,workShopName:this.order.workShopName,currPage:1};this.$http(""+i.c.CONTAINERLIST_API,"POST",e).then(function(e){var a=e.data;0===a.code?t.wheatContainerList=a.page.list:t.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})}},getWheatDataList:function(t){var e=this;this.wheatDataList=[],this.readAudit=[],this.$http(""+i.l.INSTORAGELIST_API,"POST",{orderId:t}).then(function(t){var a=t.data;if(0===a.code){e.wheatDataList=a.wlist,e.readAudit=a.vrlist;var s="",o=0,r=0,i=0,n=0;e.wheatDataList.forEach(function(t){"noPass"===t.status?o+=1:"submit"===t.status?r+=1:"checked"===t.status?i+=1:"saved"===t.status&&(n+=1)}),o>0?s="noPass":r>0?s="submit":n>0?s="saved":i>0&&(s="checked"),e.$emit("setInStorageState",s)}else e.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})},addNewRecord:function(t,e){var a=new Date,s=Object(r.c)(a,"yyyy-MM-dd hh:mm:ss"),o=Object(r.c)(new Date(this.order.productDate),"yyyy-MM-dd hh:mm:ss");this.stockForm={wheatDeviceId:"",startWeight:0,endWeight:0,created:s,creator:this.$store.state.user.realName+"("+this.$store.state.user.name+")",changed:s,changer:this.$store.state.user.realName+"("+this.$store.state.user.name+")",orderId:this.order.orderId,flourDeviceId:t,flourDeviceName:e,recordId:this.uuid(),inPortDate:o,inPortBatch:"",delFlag:"0"},this.dialogFormVisible=!0,void 0!==this.$refs.stockForm&&this.$refs.stockForm.resetFields()},modifyOldRecord:function(t){this.isRedact&&"submit"!==t.status&&"checked"!==t.status&&(this.dialogFormVisible=!0,this.stockForm=o()({},t),this.stockForm.changed=Object(r.c)(new Date,"yyyy-MM-dd hh:mm:ss"),this.stockForm.changer=this.$store.state.user.realName+"("+this.$store.state.user.name+")")},cacheStockData:function(){var t=this;this.$refs.stockForm.validate(function(e){if(e){var a=[];if(a=t.stockForm.hasOwnProperty("recordId")?t.wheatDataList.filter(function(e){return e.recordId===t.stockForm.recordId}):t.wheatDataList.filter(function(e){return e.id===t.stockForm.id}),t.stockForm.inPortWeight=t.stockForm.endWeight-t.stockForm.startWeight,a&&a.length>0)o()(a[0],t.stockForm);else{var s=o()({},t.stockForm);t.wheatDataList.push(s)}t.dialogFormVisible=!1}})},saveIn:function(t){var e=this;this.wheatDataList.length>0?(this.wheatDataList.forEach(function(t){void 0!==t.status&&null!=t.status&&""!==t.status.trim()||(t.status="saved")}),this.$http(i.l.INSTORAGESAVE_API,"POST",this.wheatDataList).then(function(a){var s=a.data;0===s.code||e.$message.error(s.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},submitIn:function(t){var e=this;this.wheatDataList.length>0?(this.wheatDataList.forEach(function(t){"checked"!==t.status&&(t.status="submit")}),this.$http(""+i.l.INSTORAGESUBMIT_API,"POST",this.wheatDataList).then(function(a){var s=a.data;0===s.code||e.$message.error(s.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},changeWheatContainer:function(t){var e=this.wheatContainerList.find(function(e){return e.holderId===t}),a="";e&&(this.stockForm.wheatDeviceName=e.holderName,a=e.holderNo);var s=new Date;this.stockForm.inPortBatch=Object(r.c)(s,"yyMMdd")+a},dellistbomS:function(t){t.delFlag="1"},rowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""}},computed:{operator:function(){return"("+this.stockForm.changer+")"+this.stockForm.changer}},watch:{"order.productDate":function(t,e){this.wheatDataList.forEach(function(e){"submit"!==e.status&&"checked"!==e.status&&(e.inPortDate=Object(r.c)(new Date(t),"yyyy-MM-dd hh:mm:ss"))})}},components:{AuditLog:function(t){a.e(1).then(function(){var e=[a("bpq2")];t.apply(null,e)}.bind(this)).catch(a.oe)}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",[a("div",t._l(t.flourContainerList,function(e,s){return s%4==0?a("el-row",{key:s,staticStyle:{"margin-top":"5px"},attrs:{gutter:36}},[s<t.flourContainerList.length?a("el-col",{attrs:{span:6}},[a("div",{staticClass:"stock-box"},[a("div",{staticClass:"stock-img"}),t._v(" "),a("div",{staticClass:"stock-text"},[t._v(t._s(t.flourContainerList[s].holderName))]),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),t.isRedact&&"submit"!=t.inStorageState&&"checked"!=t.inStorageState?a("div",{staticClass:"stock-button enabled",on:{click:function(e){return t.addNewRecord(t.flourContainerList[s].holderId,t.flourContainerList[s].holderName)}}},[t._v(" 入罐")]):a("div",{staticClass:"stock-button disabled"},[t._v(" 入罐")])])]):t._e(),t._v(" "),s+1<t.flourContainerList.length?a("el-col",{attrs:{span:6}},[a("div",{staticClass:"stock-box"},[a("div",{staticClass:"stock-img"}),t._v(" "),a("div",{staticClass:"stock-text"},[t._v(t._s(t.flourContainerList[s+1].holderName))]),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),t.isRedact&&"submit"!=t.inStorageState&&"checked"!=t.inStorageState?a("div",{staticClass:"stock-button enabled",on:{click:function(e){return t.addNewRecord(t.flourContainerList[s+1].holderId,t.flourContainerList[s+1].holderName)}}},[t._v(" 入罐")]):a("div",{staticClass:"stock-button disabled"},[t._v(" 入罐")])])]):t._e(),t._v(" "),s+2<t.flourContainerList.length?a("el-col",{attrs:{span:6}},[a("div",{staticClass:"stock-box"},[a("div",{staticClass:"stock-img"}),t._v(" "),a("div",{staticClass:"stock-text"},[t._v(t._s(t.flourContainerList[s+2].holderName))]),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),t.isRedact&&"submit"!=t.inStorageState&&"checked"!=t.inStorageState?a("div",{staticClass:"stock-button enabled",on:{click:function(e){return t.addNewRecord(t.flourContainerList[s+2].holderId,t.flourContainerList[s+2].holderName)}}},[t._v(" 入罐")]):a("div",{staticClass:"stock-button disabled"},[t._v(" 入罐")])])]):t._e(),t._v(" "),s+3<t.flourContainerList.length?a("el-col",{attrs:{span:6}},[a("div",{staticClass:"stock-box"},[a("div",{staticClass:"stock-img"}),t._v(" "),a("div",{staticClass:"stock-text"},[t._v(t._s(t.flourContainerList[s+3].holderName))]),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),t.isRedact&&"submit"!=t.inStorageState&&"checked"!=t.inStorageState?a("div",{staticClass:"stock-button enabled",on:{click:function(e){return t.addNewRecord(t.flourContainerList[s+3].holderId,t.flourContainerList[s+3].holderName)}}},[t._v(" 入罐")]):a("div",{staticClass:"stock-button disabled"},[t._v(" 入罐")])])]):t._e()],1):t._e()}),1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-col",[a("el-table",{attrs:{"header-row-class-name":"tableHead",data:t.wheatDataList,border:"","tooltip-effect":"dark","row-class-name":t.rowDelFlag},on:{"row-dblclick":t.modifyOldRecord}},[a("el-table-column",{attrs:{label:"日期",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(t._f("formatDate")(e.row.inPortDate))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"麦粉计量仓","show-overflow-tooltip":!0,width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(e.row.flourDeviceName)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"80",label:"粮仓"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(e.row.wheatDeviceName)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"90",label:"起始"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(e.row.startWeight)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"结束",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.endWeight))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"入库数",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.inPortWeight))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.weightUnit="kg"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"入库批次",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.inPortBatch))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作人员",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.changer))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作时间",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.changed))])]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status},on:{click:function(a){return t.dellistbomS(e.row)}}})]}}])})],1)],1)],1)],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("auditLog",{attrs:{tableData:t.readAudit}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:this.stockForm.flourDeviceName,visible:t.dialogFormVisible,width:"450px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"stockForm",attrs:{model:t.stockForm,rules:t.dataRule}},[a("el-form-item",{attrs:{label:"粮仓","label-width":t.formLabelWidth,required:"",prop:"wheatDeviceId"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{"value-key":"wheatDeviceId",placeholder:"请选择粮仓",disabled:!t.isRedact},on:{change:t.changeWheatContainer},model:{value:t.stockForm.wheatDeviceId,callback:function(e){t.$set(t.stockForm,"wheatDeviceId",e)},expression:"stockForm.wheatDeviceId"}},t._l(t.wheatContainerList,function(t,e){return a("el-option",{key:e,attrs:{label:t.holderName,value:t.holderId}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"起始(KG)","label-width":t.formLabelWidth,required:"",prop:"startWeight"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{tyle:"number",disabled:!t.isRedact},model:{value:t.stockForm.startWeight,callback:function(e){t.$set(t.stockForm,"startWeight",t._n(e))},expression:"stockForm.startWeight"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束(KG)","label-width":t.formLabelWidth,required:"",prop:"endWeight"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{tyle:"number",disabled:!t.isRedact},model:{value:t.stockForm.endWeight,callback:function(e){t.$set(t.stockForm,"endWeight",t._n(e))},expression:"stockForm.endWeight"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"入库批次","label-width":t.formLabelWidth,required:"",prop:"inPortBatch"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{maxlength:"10",disabled:!t.isRedact},model:{value:t.stockForm.inPortBatch,callback:function(e){t.$set(t.stockForm,"inPortBatch",e)},expression:"stockForm.inPortBatch"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"操作时间","label-width":t.formLabelWidth}},[a("label",[t._v(t._s(t.stockForm.changed))])]),t._v(" "),a("el-form-item",{attrs:{label:"操作人","label-width":t.formLabelWidth}},[a("label",[t._v(t._s(t.stockForm.changer))])])],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:!t.isRedact},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:!t.isRedact},on:{click:function(e){return t.cacheStockData()}}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,l,!1,function(t){a("Q2Rb")},"data-v-66f9d5bc",null);e.default=c.exports},Q2Rb:function(t,e){}});
//# sourceMappingURL=92.39eb92cd095237a706a5.js.map