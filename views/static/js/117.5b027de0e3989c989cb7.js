webpackJsonp([117],{l3K6:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("BO1k"),s=a.n(r),i=a("P9l9"),o=a("Lna1"),l={data:function(){return{dictListObj:{},dispatcherCode:"",materielDataList:[],readAudit:[]}},mounted:function(){this.getDictList()},props:{isRedact:Boolean,appyMaterielState:String,order:Object},methods:{saveOrderMateriel:function(){var t=this;if(this.materielDataList.length>0&&this.validate("apply")){var e=!0,a=!1,r=void 0;try{for(var o,l=s()(this.materielDataList);!(e=(o=l.next()).done);e=!0){o.value.status="submit"}}catch(t){a=!0,r=t}finally{try{!e&&l.return&&l.return()}finally{if(a)throw r}}this.$http(""+i.l.MATERIELSAVEORDER_API,"POST",this.materielDataList).then(function(e){var a=e.data;0===a.code?t.$emit("updateOrderInfo",{orderId:a.orderId,orderNo:a.orderNo}):t.$message.error(a.msg||"申请订单失败，请稍后尝试")}).catch(function(t){console.log("catch data::",t)})}},saveMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){void 0!==t.status&&null!=t.status&&""!==t.status.trim()||(t.status="saved")}),this.$http(i.l.MATERIELSAVE_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},submitMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){"checked"!==t.status&&(t.status="submit")}),this.$http(i.l.MATERIELSUBMIT_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},validate:function(t){var e=!0,a=!1,r=void 0;try{for(var i,o=s()(this.materielDataList);!(e=(i=o.next()).done);e=!0){var l=i.value;if("0"===l.delFlag){if(null===l.dispatchMan||""===l.dispatchMan.trim())return this.$message.error("生产调度员不能为空"),!1;if(null===l.productCode||""===l.productCode.trim())return this.$message.error("生产物料不能为空"),!1;if(null===l.issueCode||""===l.issueCode.trim())return this.$message.error("发料料号不能为空"),!1;if(""===l.productWeight)return this.$message.error("生产数不能为空"),!1;if(null===l.issueBatch||""===l.issueBatch.trim())return this.$message.error("发料批次不能为空"),!1;if(l.issueBatch.trim().length>10)return this.$message.error("发料批次长度不能超过10"),!1;if(""===l.inStorageWeight)return this.$message.error("入库数不能为空"),!1;if(t&&"submit"===t&&(null===l.inStorageBatch||""===l.inStorageBatch.trim()))return this.$message.error("入库批次不能为空"),!1;if(l.inStorageBatch&&l.inStorageBatch.trim().length>10)return this.$message.error("入库批次长度不能超过10"),!1}}}catch(t){a=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw r}}return!0},getDictList:function(t){var e=this;this.dictListObj={};this.$http(""+i.k.PARAMETERSLIST_API,"POST",["PW_FEVOR","CM_material_prd","CM_material"]).then(function(t){var a=t.data;if(0===a.code){var r=!0,i=!1,o=void 0;try{for(var l,n=s()(a.dicList);!(r=(l=n.next()).done);r=!0){var c=l.value;e.$set(e.dictListObj,c.shname,c.prolist)}}catch(t){i=!0,o=t}finally{try{!r&&n.return&&n.return()}finally{if(i)throw o}}}else e.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})},getMaterielDataList:function(t){var e=this;this.materielDataList=[],this.readAudit=[];var a="";this.$http(""+i.l.MATERIELLIST_API,"POST",{orderId:t},!1,!1,!1).then(function(t){var r=t.data;if(0===r.code){e.materielDataList=r.wlist,e.readAudit=r.vrlist;var s=0,i=0,o=0,l=0;e.materielDataList.forEach(function(t){"noPass"===t.status?s+=1:"submit"===t.status?i+=1:"checked"===t.status?o+=1:"saved"===t.status&&(l+=1)}),s>0?a="noPass":i>0?a="submit":l>0?a="saved":o>0&&(a="checked")}else e.$message.error(r.msg)}).catch(function(t){console.log("catch data::",t)}).finally(function(){e.$emit("setAppyMaterielState",a)})},addNewRecord:function(){var t=this.materielDataList.filter(function(t){return"0"===t.delFlag}),e=t&&t.length>0?t[t.length-1]:null,a=Object(o.c)(new Date,"yyyy-MM-dd hh:mm:ss"),r=this.$store.state.user.realName;this.materielDataList.push({branWeight:e?e.branWeight:0,delFlag:"0",dispatchMan:this.dispatcherCode,gmCode:"02",granuleWeight:e?e.granuleWeight:0,inStorageBatch:e?e.inStorageBatch:"",inStorageWeight:e?e.inStorageWeight:0,issueBatch:e?e.issueBatch:"",issueCode:e?e.issueCode:"",issueName:e?e.issueName:"",issueWeight:e?e.issueWeight:0,productCode:e?e.productCode:"",productName:e?e.productName:"",productUnit:"KG",productWeight:e?e.productWeight:0,remark:e?e.remark:"",scrappedWeight:e?e.scrappedWeight:0,storageWeight:e?e.storageWeight:0,productDate:this.order&&this.order.productDate,factory:this.order&&this.order.factory,workShop:this.order&&this.order.workShop,productLine:this.order&&this.order.productLine,created:a,creator:r,changed:a,changer:r,orderId:this.order&&this.order.orderId,orderNo:this.order&&this.order.orderNo})},dellistbomS:function(t){t.delFlag="1"},rowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""},changeProductWeight:function(t){var e=!0,a=!1,r=void 0;try{for(var i,o=s()(this.materielDataList);!(e=(i=o.next()).done);e=!0){var l=i.value;l.recordId===t.recordId&&(l.inStorageWeight=l.productWeight)}}catch(t){a=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw r}}},changeProduct:function(t){var e=this.dictListObj.CM_material_prd.find(function(e){return e.code===t.productCode});e&&(t.productName=e.value)},changeIssue:function(t){var e=this.dictListObj.CM_material.find(function(e){return e.code===t.issueCode});e&&(t.issueName=e.value)}},computed:{enableSubmit:function(){return void 0===this.order||void 0===this.order.orderId||0===this.order.orderId.trim().length}},watch:{"order.productDate":function(t,e){this.materielDataList.forEach(function(e){"submit"!==e.status&&"checked"!==e.status&&(e.productDate=t)})},dispatcherCode:function(t,e){this.materielDataList.forEach(function(e){"submit"!==e.status&&"checked"!==e.status&&(e.dispatchMan=t)})}},components:{AuditLog:function(t){a.e(1).then(function(){var e=[a("bpq2")];t.apply(null,e)}.bind(this)).catch(a.oe)}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{attrs:{"body-style":"padding-top:10px;"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form",{ref:"form",attrs:{"label-width":"100px"}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"生产调度员"}},[a("el-select",{attrs:{size:"small","value-key":"dispatcherCode",placeholder:"请选择生产调度员",disabled:!t.isRedact||"submit"==t.appyMaterielState||"checked"==t.appyMaterielState},model:{value:t.dispatcherCode,callback:function(e){t.dispatcherCode=e},expression:"dispatcherCode"}},t._l(this.dictListObj.PW_FEVOR,function(t,e){return a("el-option",{key:e,attrs:{label:t.code,value:t.code}})}),1)],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"btn",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",size:"small",disabled:!t.isRedact||"submit"==t.appyMaterielState||"checked"==t.appyMaterielState},on:{click:t.addNewRecord}},[t._v("新增")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"primary",size:"small",disabled:!t.isRedact||!t.enableSubmit},on:{click:t.saveOrderMateriel}},[t._v("申请订单")])],1)])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-table",{ref:"table1",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{"header-row-class-name":"tableHead",data:t.materielDataList,"row-class-name":t.rowDelFlag,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"生产物料",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"productCode",placeholder:"请选择生产物料",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeProduct(e.row)}},model:{value:e.row.productCode,callback:function(a){t.$set(e.row,"productCode",a)},expression:"scope.row.productCode"}},t._l(t.dictListObj.CM_material_prd,function(t,e){return a("el-option",{key:e,attrs:{label:t.code+" "+t.value,value:t.code}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"生产数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},on:{input:function(a){return t.changeProductWeight(e.row)}},model:{value:e.row.productWeight,callback:function(a){t.$set(e.row,"productWeight",t._n(a))},expression:"scope.row.productWeight"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"60",label:"单位"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.productUnit="KG")+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"220",label:"发料料号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"issueCode",placeholder:"请选择发料料号",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeIssue(e.row)}},model:{value:e.row.issueCode,callback:function(a){t.$set(e.row,"issueCode",a)},expression:"scope.row.issueCode"}},t._l(t.dictListObj.CM_material,function(t,e){return a("el-option",{key:e,attrs:{label:t.code+" "+t.value,value:t.code}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"小麦数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.issueWeight=Number(e.row.branWeight)+Number(e.row.granuleWeight)+Number(e.row.scrappedWeight)+Number(e.row.inStorageWeight))+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"麸皮"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.branWeight,callback:function(a){t.$set(e.row,"branWeight",t._n(a))},expression:"scope.row.branWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"小颗粒"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.granuleWeight,callback:function(a){t.$set(e.row,"granuleWeight",t._n(a))},expression:"scope.row.granuleWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"报废小麦"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.scrappedWeight,callback:function(a){t.$set(e.row,"scrappedWeight",t._n(a))},expression:"scope.row.scrappedWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"发料批次"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{maxlength:"10",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.issueBatch,callback:function(a){t.$set(e.row,"issueBatch",a)},expression:"scope.row.issueBatch"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"入库数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.inStorageWeight,callback:function(a){t.$set(e.row,"inStorageWeight",t._n(a))},expression:"scope.row.inStorageWeight"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"入库批次"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{maxlength:"10",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.inStorageBatch,callback:function(a){t.$set(e.row,"inStorageBatch",a)},expression:"scope.row.inStorageBatch"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"库存数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.storageWeight,callback:function(a){t.$set(e.row,"storageWeight",t._n(a))},expression:"scope.row.storageWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"200",label:"生产订单"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.orderNo)+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status},on:{click:function(a){return t.dellistbomS(e.row)}}})]}}])})],1)],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("auditLog",{attrs:{tableData:t.readAudit}})],1)],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(l,n,!1,function(t){a("rx40")},"data-v-276158fa",null);e.default=c.exports},rx40:function(t,e){}});
//# sourceMappingURL=117.5b027de0e3989c989cb7.js.map