webpackJsonp([77],{Yq0z:function(e,t){},sEmv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("P9l9"),r={name:"materiel",data:function(){return{MaterielDate:[],MaterielAuditlog:[],Materielstatus:"",brine:[],brineTankNo:[]}},props:{isRedact:{},formHeader:{}},mounted:function(){this.GetBrine()},methods:{GetmaterielDate:function(e){var t=this;this.$http(""+l.d.OUTMATERIELLIST_API,"POST",{orderId:e.orderId,orderHouseId:e.id,orderNo:e.orderNo}).then(function(e){var a=e.data;if(0===a.code){t.MaterielDate=a.list,t.MaterielAuditlog=a.vrlist;var l=0,r=0,s=0,o=0;t.MaterielDate.forEach(function(e){e.material=e.materialCode+" "+e.materialName,"noPass"===e.status?s+=1:"submit"===e.status?l+=1:"checked"===e.status?r+=1:"saved"===e.status&&(o+=1)}),s>0?t.Materielstatus="noPass":l>0?t.Materielstatus="submit":o>0?t.Materielstatus="saved":r>0&&(t.Materielstatus="checked"),t.$emit("GetMaterielStatus",t.Materielstatus)}else t.$message.error(a.msg)})},saveRul:function(){var e=this,t=!0;return this.MaterielDate.forEach(function(a){if("1"!==a.delFlag&&(!a.material||!a.saltWaterHolderId||!a.startValue&&0!==a.startValue||!a.endValue&&0!==a.endValue))return t=!1,e.$message.error("原料领用必填项未填"),!1}),t},SaveOrSubmitMateriel:function(e,t,a){var r=this;this.MaterielDate.forEach(function(t){t.orderHouseId=r.formHeader.id,t.material&&(t.materialCode=t.material.substring(0,t.material.indexOf(" ")),t.materialName=t.material.substring(t.material.indexOf(" ")+1)),t.status?"saved"===t.status?t.status=e:"noPass"===t.status&&"submit"===e&&(t.status=e):t.status=e}),this.$http(""+("submit"===e?l.d.OUTMATERIELSUBMIT_API:l.d.OUTMATERIELSAVE_API),"POST",this.MaterielDate).then(function(e){var l=e.data;0===l.code?t&&t("resolve"):(r.$message.error(l.msg),a&&a("原料领用"+l.msg))})},GetBrine:function(){var e=this;this.$http(l.k.PARAMETERLIST_API+"?type=ZQ_MATERIAL_YANSHUI","POST").then(function(t){var a=t.data;0===a.code?e.brine=a.dicList:e.$message.error(a.msg)})},GetBrineTankNo:function(e){var t=this;this.$http(""+l.c.CONTAINERLIST_API,"POST",{factory:e.factory,dept_id:e.workShop,type:"holder_type",holder_type:"011",currPage:1,pageSize:9999}).then(function(e){var a=e.data;0===a.code?t.brineTankNo=a.page.list:t.$message.error(a.msg)})},AddMateriel:function(){this.MaterielDate.push({id:"",status:"",orderHouseId:"",outDate:"",material:"",materialCode:"",materialName:"",saltWaterHolderId:"",startValue:"",endValue:"",amount:"",unit:"L",delFlag:"0"})},delMateriel:function(e){e.delFlag="1"},RowDelFlag:function(e){var t=e.row;e.rowIndex;return"1"===t.delFlag?"rowDel":""}},computed:{BrineNum:function(){var e=0;return this.MaterielDate.forEach(function(t){e+="0"===t.delFlag?1*t.amount:0}),console.log("原料领用"),console.log(e),this.$emit("SetMeaterielNum",e),e}},components:{AuditLog:function(e){a.e(1).then(function(){var t=[a("bpq2")];e.apply(null,t)}.bind(this)).catch(a.oe)}}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small",disabled:!e.isRedact},on:{click:function(t){return e.AddMateriel(e.MaterielDate)}}},[e._v("新增")]),e._v(" "),a("el-table",{attrs:{"header-row-class-name":"tableHead",data:e.MaterielDate,"row-class-name":e.RowDelFlag,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{label:"盐水",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{placeholder:"请选择",disabled:!(e.isRedact&&"submit"!==t.row.status&&"checked"!==t.row.status),size:"small"},model:{value:t.row.material,callback:function(a){e.$set(t.row,"material",a)},expression:"scope.row.material"}},e._l(e.brine,function(e,t){return a("el-option",{key:t,attrs:{label:e.value,value:e.code+" "+e.value}})}),1)]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[e._v("*")]),e._v(" "),a("span",[e._v("盐水")])])],2),e._v(" "),a("el-table-column",{attrs:{label:"盐水罐号",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{placeholder:"请选择",disabled:!(e.isRedact&&"submit"!==t.row.status&&"checked"!==t.row.status),size:"small"},model:{value:t.row.saltWaterHolderId,callback:function(a){e.$set(t.row,"saltWaterHolderId",a)},expression:"scope.row.saltWaterHolderId"}},e._l(e.brineTankNo,function(e,t){return a("el-option",{key:t,attrs:{label:e.holderName,value:e.holderId}})}),1)]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[e._v("*")]),e._v(" "),a("span",[e._v("盐水罐号")])])],2),e._v(" "),a("el-table-column",{attrs:{label:"起始值",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{type:"number",disabled:!(e.isRedact&&"submit"!==t.row.status&&"checked"!==t.row.status),size:"small",placeholder:"手工录入"},model:{value:t.row.startValue,callback:function(a){e.$set(t.row,"startValue",a)},expression:"scope.row.startValue"}})]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[e._v("*")]),e._v(" "),a("span",[e._v("起始值")])])],2),e._v(" "),a("el-table-column",{attrs:{label:"结束值",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{type:"number",disabled:!(e.isRedact&&"submit"!==t.row.status&&"checked"!==t.row.status),size:"small",placeholder:"手工录入"},model:{value:t.row.endValue,callback:function(a){e.$set(t.row,"endValue",a)},expression:"scope.row.endValue"}})]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[e._v("*")]),e._v(" "),a("span",[e._v("结束值")])])],2),e._v(" "),a("el-table-column",{attrs:{label:"数量",width:"90","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.amount=(1e3*(1*t.row.endValue-1*t.row.startValue)).toFixed(2))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"单位",width:"50",prop:"unit","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作人",prop:"creator","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间",prop:"created","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!(e.isRedact&&"submit"!==t.row.status&&"checked"!==t.row.status)},on:{click:function(a){return e.delMateriel(t.row)}}})]}}])})],1),e._v(" "),a("p",{staticStyle:{"line-height":"32px"}},[e._v("总数量："+e._s(e.BrineNum))]),e._v(" "),a("audit-log",{attrs:{tableData:e.MaterielAuditlog}})],1)},staticRenderFns:[]};var o=a("C7Lr")(r,s,!1,function(e){a("Yq0z")},"data-v-b28526b4",null);t.default=o.exports}});
//# sourceMappingURL=77.cbedf2536476d15c1463.js.map