webpackJsonp([119],{"5Rtt":function(t,e){},S5XQ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("P9l9"),i={name:"material",data:function(){return{SumDate:[],materialDate:[],potList:[],materialS:""}},props:{isRedact:"",fumet:{type:Array,default:function(){return[]}},SerchSapList:{type:Array,default:function(){return[]}}},mounted:function(){},methods:{getMaterialList:function(t,e,a){var i=this;this.$http(""+l.j.SUM_MATERIAL_LIST_API,"POST",t).then(function(t){var l=t.data;if(0===l.code){i.materialDate=l.maList;var r=0,o=0,s=0,c=0;l.maList.forEach(function(t){"noPass"===t.status?s+=1:"submit"===t.childStatus?r+=1:"checked"===t.childStatus?o+=1:"saved"===t.childStatus?c+=1:""===t.childStatus&&(c+=1)}),s>0?i.materialS="noPass":r>0?i.materialS="submit":c>0?i.materialS="saved":o>0&&(i.materialS="checked"),i.mergeDate(),e&&e("resolve")}else a&&a(l.msg),i.$message.error(l.msg)})},updateMaterial:function(t,e,a){var i=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[];this.SumDate.forEach(function(e,a){e.status?"saved"===e.material.childStatus?e.material.childStatus=t:"noPass"===e.material.childStatus&&"submit"===t&&(e.material.childStatus=t):e.material.childStatus=t,e.material.childMaterialCode=e.material.childMaterial.substring(0,e.material.childMaterial.indexOf(" ")),e.material.childMaterialName=e.material.childMaterial.substring(e.material.childMaterial.indexOf(" ")+1),"1"===e.delFlag&&(e.material.delFlag="1"),o.push(e.material)}),this.$http(""+(!1===r?l.j.SUM_MATERIAL_UPDATE_API:l.j.SUM_MATERIAL_SUBMIT_API),"POST",o).then(function(t){var l=t.data;0===l.code?e&&e("resolve"):(a&&a(l.msg),i.$message.error(l.msg))})},materialRul:function(){var t=this,e=!0;return this.SumDate.forEach(function(a){if(!a.material.childPotNo&&!a.material.childUsedAmount)return e=!1,t.$message.error("物料领用必填项未填写"),!1}),e},splitDate:function(t,e){this.SumDate.splice(e+2,0,{fumet:t,material:{childId:"",midPrsOrderId:t.id,childMaterial:"",childMaterialCode:"",childMaterialName:"",childPotNo:"",childUsedAmount:"",childUnit:"",childBatch:"",childFullPotAmount:"",childRecordMan:"",childRemark:"",childDelFlag:"0"}})},dellist:function(t){var e=0;this.SumDate.forEach(function(a){"1"!==a.delFlag&&t.fumet.id===a.fumet.id&&e++}),console.log(e),e>1?(t.delFlag="1",console.log(this.SumDate)):this.$message.error("此订单最后一条了，不能删除")},RowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""},getPot:function(t){var e=this;this.$http(""+l.c.CONTAINERLIST_API,"POST",{holder_type:"001",type:"holder_type",factory:t.factory,dept_id:t.workShop,currPage:1,pageSize:9999}).then(function(t){var a=t.data;0===a.code?e.potList=a.page.list:e.$message.error(a.msg)})},mergeDate:function(){var t=this;this.SumDate=[],0===this.materialDate.length?this.fumet.forEach(function(e,a){var l={childId:"",midPrsOrderId:e.id,childMaterial:"",childMaterialCode:"",childMaterialName:"",childPotNo:"",childUsedAmount:"",childUnit:"",childBatch:"",childFullPotAmount:"",childRecordMan:"",childRemark:"",childStatus:"",childDelFlag:"0"};t.SumDate.push({fumet:e,material:l,delFlag:"0"})}):(this.materialDate.forEach(function(e,a){e.childMaterial=e.childMaterialCode+" "+e.childMaterialName;var l=t.fumet.find(function(t){return t.id===e.midPrsOrderId});t.SumDate.push({fumet:l,material:e,delFlag:"0"})}),this.fumet.forEach(function(e){if(void 0===t.materialDate.find(function(t){return t.midPrsOrderId===e.id})){var a={childId:"",midPrsOrderId:e.id,childMaterial:"",childMaterialCode:"",childMaterialName:"",childPotNo:"",childUsedAmount:"",childUnit:"",childBatch:"",childFullPotAmount:"",childRecordMan:"",childRemark:"",childStatus:"",childDelFlag:"0"};t.SumDate.push({fumet:e,material:a,delFlag:"0"})}}))}},computed:{dangerIf:function(){return function(t){var e=0;return this.SumDate.forEach(function(a){"1"!==a.delFlag&&t.fumet.id===a.fumet.id&&e++}),e>1}}},components:{}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{staticClass:"clearfix"},[a("p",{staticStyle:{float:"left","font-size":"14px"}},[t._v("布浆总量：")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small",disabled:!0}},[t._v("酱醪领用")])],1),t._v(" "),a("el-table",{ref:"table1",attrs:{"header-row-class-name":"tableHead",data:t.SumDate,"row-class-name":t.RowDelFlag}},[a("el-table-column",{attrs:{label:"原汁信息"}},[a("el-table-column",{attrs:{width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.fumet.potNoName))]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[t._v("*")]),a("span",[t._v("原汁罐号")])])],2),t._v(" "),a("el-table-column",{attrs:{label:"是否混合罐",width:"95",prop:"fumet.fullPort"}}),t._v(" "),a("el-table-column",{attrs:{label:"物料",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.fumet.material))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"入罐数量",width:"120",prop:"fumet.inPotAmount"}}),t._v(" "),a("el-table-column",{attrs:{label:"满罐数量",width:"140",prop:"fumet.fullPotAmount"}}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"50",prop:"fumet.unit"}}),t._v(" "),a("el-table-column",{attrs:{label:"满罐日期",width:"140",prop:"fumet.fullPotDate"}}),t._v(" "),a("el-table-column",{attrs:{label:"原汁批次",width:"140",prop:"fumet.batch"}}),t._v(" "),a("el-table-column",{attrs:{label:"生产订单",width:"140",prop:"fumet.orderNo"}})],1),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["正常"!==e.row.fumet.fullPort?a("el-button",{attrs:{type:"text",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status)},on:{click:function(a){return t.splitDate(e.row.fumet,t.$index)}}},[a("i",{staticClass:"icons iconfont factory-chaifen"}),t._v("拆分")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"酱醪领用"}},[a("el-table-column",{attrs:{label:"物料",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{filterable:"",placeholder:"请选择",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status),size:"small"},model:{value:e.row.material.childMaterial,callback:function(a){t.$set(e.row.material,"childMaterial",a)},expression:"scope.row.material.childMaterial"}},t._l(t.SerchSapList,function(t){return a("el-option",{key:t.code+" "+t.value,attrs:{label:t.code+" "+t.value,value:t.code+" "+t.value}})}),1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{filterable:"",placeholder:"请选择",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status),size:"small"},model:{value:e.row.material.childPotNo,callback:function(a){t.$set(e.row.material,"childPotNo",a)},expression:"scope.row.material.childPotNo"}},t._l(t.potList,function(t){return a("el-option",{key:t.holderId,attrs:{label:t.holderName,value:t.holderId}})}),1)]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[t._v("*")]),a("span",[t._v("发酵罐号")])])],2),t._v(" "),a("el-table-column",{attrs:{width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"small",placeholder:"手工录入",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status)},model:{value:e.row.material.childUsedAmount,callback:function(a){t.$set(e.row.material,"childUsedAmount",a)},expression:"scope.row.material.childUsedAmount"}})]}}])},[a("template",{slot:"header"},[a("i",{staticClass:"reqI"},[t._v("*")]),a("span",[t._v("当日用量")])])],2),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.material.childUnit="L"))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"物料批次",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"small",placeholder:"手工录入",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status)},model:{value:e.row.material.childBatch,callback:function(a){t.$set(e.row.material,"childBatch",a)},expression:"scope.row.material.childBatch"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"满罐数量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"small",placeholder:"手工录入",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status)},model:{value:e.row.material.childFullPotAmount,callback:function(a){t.$set(e.row.material,"childFullPotAmount",a)},expression:"scope.row.material.childFullPotAmount"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"记录人",width:"120",prop:"material.childRecordMan"}})],1),t._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.dangerIf(e.row)?a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!(t.isRedact&&"submit"!==e.row.material.status&&"checked"!==e.row.material.status)},on:{click:function(a){return t.dellist(e.row)}}}):t._e()]}}])})],1)],1)},staticRenderFns:[]};var o=a("C7Lr")(i,r,!1,function(t){a("5Rtt")},"data-v-23b1b1b6",null);e.default=o.exports}});
//# sourceMappingURL=119.6879352d77cb4d30527d.js.map