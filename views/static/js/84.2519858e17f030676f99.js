webpackJsonp([84],{Dcde:function(t,e){},jz5R:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("BO1k"),i=a.n(r),s=a("P9l9"),l={data:function(){return{materialDictList:[],wheatContainerList:[],readAudit:[],materielDataList:[]}},mounted:function(){this.getMaterialDictList(),this.getWheatContainerList()},props:{isRedact:Boolean,applyMaterielState:String,order:Object},methods:{saveMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){void 0!==t.status&&null!=t.status&&""!==t.status.trim()||(t.status="saved")}),this.$http(s.l.APPLYMATERIELSAVE_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},submitMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){"checked"!==t.status&&(t.status="submit")}),this.$http(""+s.l.APPLYMATERIELSUBMIT_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},validate:function(){if(void 0===this.materielDataList||0===this.materielDataList.length)return this.$message.error("物料领用未录入数据"),!1;var t=!0,e=!1,a=void 0;try{for(var r,s=i()(this.materielDataList);!(t=(r=s.next()).done);t=!0){var l=r.value;if("0"===l.delFlag){if(null==l.materialCode||""===l.materialCode.trim())return this.$message.error("物料不能为空"),!1;if(null==l.deviceId||""===l.deviceId)return this.$message.error("粮仓不能为空"),!1;if(null==l.batch||""===l.batch.trim())return this.$message.error("物料批次不能为空"),!1;if(l.batch.trim().length>10)return this.$message.error("物料批次长度不能超过10"),!1;if(""===l.wheatWeight)return this.$message.error("小麦领用数不能为空"),!1;if(l.wheatWeight<=0)return this.$message.error("小麦领用数必须大于0"),!1}}}catch(t){e=!0,a=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw a}}return!0},getWheatContainerList:function(){var t=this;if(this.wheatContainerList=[],void 0!==this.order&&void 0!==this.order.workShopName){var e={type:"holder_type",holder_type:"002",pageSize:9999,workShopName:this.order.workShopName,currPage:1};this.$http(""+s.c.CONTAINERLIST_API,"POST",e).then(function(e){var a=e.data;0===a.code?t.wheatContainerList=a.page.list:t.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})}},getMaterialDictList:function(){var t=this;this.materialDictList=[],this.$http(s.k.PARAMETERLIST_API+"?type=CM_material","POST").then(function(e){var a=e.data;0===a.code?t.materialDictList=a.dicList:t.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})},getMaterielDataList:function(t){var e=this;this.materielDataList=[],this.readAudit=[];var a="";this.$http(""+s.l.APPLYMATERIELLIST_API,"POST",{order_id:t}).then(function(t){var r=t.data;if(0===r.code){e.materielDataList=r.listForm,e.readAudit=r.listApproval;var i=0,s=0,l=0,o=0;e.materielDataList.forEach(function(t){"noPass"===t.status?i+=1:"submit"===t.status?s+=1:"checked"===t.status?l+=1:"saved"===t.status&&(o+=1)}),i>0?a="noPass":s>0?a="submit":o>0?a="saved":l>0&&(a="checked")}else e.$message.error(r.msg)}).catch(function(t){e.$message.error(t)}).finally(function(){e.$emit("setApplyMaterielState",a)})},addNewRecord:function(){var t=this.materielDataList.filter(function(t){return"0"===t.delFlag}),e=t&&t.length>0?t[t.length-1]:null;this.materielDataList.push({id:"",orderId:this.order.orderId,materialCode:e?e.materialCode:"",materialName:e?e.materialName:"",deviceId:e?e.deviceId:"",holderName:e?e.holderName:"",batch:e?e.batch:"",wheatWeight:e?e.wheatWeight:0,weightUnit:"KG",remark:e?e.remark:"",delFlag:"0"})},dellistbomS:function(t){t.delFlag="1"},rowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""},changeWheatContainer:function(t){var e=this.wheatContainerList.find(function(e){return e.holderId===t.deviceId});e&&(t.holderName=e.holderName)},changeProduct:function(t){var e=this.materialDictList.find(function(e){return e.code===t.materialCode});e&&(t.materialName=e.value)}},computed:{totalInstock:function(){var t=0,e=!0,a=!1,r=void 0;try{for(var s,l=i()(this.materielDataList);!(e=(s=l.next()).done);e=!0){var o=s.value;"0"===o.delFlag&&"number"==typeof o.wheatWeight&&(t+=parseFloat(o.wheatWeight))}}catch(t){a=!0,r=t}finally{try{!e&&l.return&&l.return()}finally{if(a)throw r}}return t}},watch:{},components:{AuditLog:function(t){a.e(1).then(function(){var e=[a("bpq2")];t.apply(null,e)}.bind(this)).catch(a.oe)}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{attrs:{"body-style":"padding-top:10px;"}},[a("div",{staticClass:"clearfix topBox"},[a("div",{staticClass:"btn",staticStyle:{"margin-bottom":"8px"}},[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small",disabled:!t.isRedact||"submit"==t.applyMaterielState||"checked"==t.applyMaterielState},on:{click:function(e){return t.addNewRecord()}}},[t._v("新增")]),t._v(" "),a("div",{staticClass:"clearfix"})],1)]),t._v(" "),a("el-table",{ref:"table1",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{"header-row-class-name":"tableHead",data:t.materielDataList,"row-class-name":t.rowDelFlag,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"物料",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"materialCode",placeholder:"请选择物料",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeProduct(e.row)}},model:{value:e.row.materialCode,callback:function(a){t.$set(e.row,"materialCode",a)},expression:"scope.row.materialCode"}},t._l(t.materialDictList,function(t,e){return a("el-option",{key:e,attrs:{label:t.code+" "+t.value,value:t.code}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"粮仓","show-overflow-tooltip":!0,width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"deviceId",placeholder:"请选择粮仓",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeWheatContainer(e.row)}},model:{value:e.row.deviceId,callback:function(a){t.$set(e.row,"deviceId",a)},expression:"scope.row.deviceId"}},t._l(t.wheatContainerList,function(t,e){return a("el-option",{key:e,attrs:{label:t.holderName,value:t.holderId}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"180",label:"物料批次"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{maxlength:"10",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,placeholder:"手工录入"},model:{value:e.row.batch,callback:function(a){t.$set(e.row,"batch",a)},expression:"scope.row.batch"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"160",label:"小麦领用数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{type:"number",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,placeholder:"手工录入"},model:{value:e.row.wheatWeight,callback:function(a){t.$set(e.row,"wheatWeight",t._n(a))},expression:"scope.row.wheatWeight"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.weightUnit="KG"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"备注",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,placeholder:"手工录入"},model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark","string"==typeof a?a.trim():a)},expression:"scope.row.remark"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status},on:{click:function(a){return t.dellistbomS(e.row)}}})]}}])})],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-col",[a("div",[a("span",[t._v("领用数合计：")]),t._v(t._s(t.totalInstock)+" KG")])])],1)],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("auditLog",{attrs:{tableData:t.readAudit}})],1)],1)],1)},staticRenderFns:[]};var n=a("C7Lr")(l,o,!1,function(t){a("Dcde")},"data-v-8fd5b3c8",null);e.default=n.exports}});
//# sourceMappingURL=84.2519858e17f030676f99.js.map