webpackJsonp([17,115,117],{"+AXQ":function(t,e){},Lkpl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("P9l9"),s={name:"pwTime",data:function(){return{pwTimeDate:[{id:"",orderNo:"",orderId:"",status:"",prepareTime:"",prepareTimeUnit:"H",machineTime:"",machineTimeUnit:"H",humanTime:"",humanTimeUnit:"H",remark:""}],timeAudit:[]}},props:{isRedact:{},order:{}},mounted:function(){},methods:{GetPwTimeList:function(){var t=this;if(this.order.orderId){var e="";this.$http(""+r.l.MATERIELTIMELIST_API,"POST",{order_id:this.order.orderId}).then(function(a){var r=a.data;0===r.code?r.listForm&&0!==r.listForm.length?(t.pwTimeDate=r.listForm,t.pwTimeDate[0].prepareTime=t.pwTimeDate[0].prepareTime,t.pwTimeDate[0].machineTime=t.pwTimeDate[0].machineTime,t.pwTimeDate[0].humanTime=t.pwTimeDate[0].humanTime,e=r.listForm[0].status,t.timeAudit=r.listApproval):t.pwTimeDate=[{id:"",orderNo:t.order.orderNo,orderId:"",status:"",prepareTime:"",prepareTimeUnit:"H",machineTime:"",machineTimeUnit:"H",humanTime:"",humanTimeUnit:"H",remark:""}]:t.$message.error(r.msg)}).finally(function(){t.$emit("SetReadyStatus",e)})}},timerul:function(){var t=!0;return!this.pwTimeDate[0].prepareTime&&0!==this.pwTimeDate[0].prepareTime||!this.pwTimeDate[0].machineTime&&0!==this.pwTimeDate[0].machineTime||!this.pwTimeDate[0].humanTime&&0!==this.pwTimeDate[0].humanTime?(t=!1,this.$message.error("工时录入必填项未填"),!1):t},PwTimeUpdate:function(t,e,a){var s=this;this.pwTimeDate[0].prepareTime=this.pwTimeDate[0].prepareTime,this.pwTimeDate[0].machineTime=this.pwTimeDate[0].machineTime,this.pwTimeDate[0].humanTime=this.pwTimeDate[0].humanTime,this.pwTimeDate[0].orderId=this.order.orderId,this.pwTimeDate[0].status=t,this.$http(""+r.l.MATERIELTIMEUPDATE_API,"POST",this.pwTimeDate[0]).then(function(t){var a=t.data;0===a.code||s.$message.error(a.msg),e&&e("resolve")}).catch(function(){e&&a("reject")})},AddpwTimeDate:function(){this.pwTimeDate.push({})},delpwTimeDate:function(t){t.delFlag="1"},RowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""}},computed:{},components:{AuditLog:function(t){a.e(1).then(function(){var e=[a("bpq2")];t.apply(null,e)}.bind(this)).catch(a.oe)}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{"header-row-class-name":"tableHead",data:t.pwTimeDate,"row-class-name":t.RowDelFlag,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"生产订单号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.orderNo)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"准备工时",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!(t.isRedact&&t.order.orderId),size:"small",placeholder:"手工录入"},model:{value:e.row.prepareTime,callback:function(a){t.$set(e.row,"prepareTime",a)},expression:"scope.row.prepareTime"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("H")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"*机器工时",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!(t.isRedact&&t.order.orderId),size:"small",placeholder:"手工录入"},model:{value:e.row.machineTime,callback:function(a){t.$set(e.row,"machineTime",a)},expression:"scope.row.machineTime"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("H")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"*人工工时",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!(t.isRedact&&t.order.orderId),size:"small",placeholder:"手工录入"},model:{value:e.row.humanTime,callback:function(a){t.$set(e.row,"humanTime",a)},expression:"scope.row.humanTime"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"单位",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("H")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"备注",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!(t.isRedact&&t.order.orderId),size:"small",placeholder:"手工录入"},model:{value:e.row.expInfo,callback:function(a){t.$set(e.row,"expInfo",a)},expression:"scope.row.expInfo"}})]}}])})],1),t._v(" "),a("audit-log",{attrs:{tableData:t.timeAudit}})],1)},staticRenderFns:[]};var o=a("C7Lr")(s,i,!1,function(t){a("ZA7j")},"data-v-2952f843",null);e.default=o.exports},ZA7j:function(t,e){},l3K6:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("BO1k"),s=a.n(r),i=a("P9l9"),o=a("Lna1"),n={data:function(){return{dictListObj:{},dispatcherCode:"",materielDataList:[],readAudit:[]}},mounted:function(){this.getDictList()},props:{isRedact:Boolean,appyMaterielState:String,order:Object},methods:{saveOrderMateriel:function(){var t=this;if(this.materielDataList.length>0&&this.validate("apply")){var e=!0,a=!1,r=void 0;try{for(var o,n=s()(this.materielDataList);!(e=(o=n.next()).done);e=!0){o.value.status="submit"}}catch(t){a=!0,r=t}finally{try{!e&&n.return&&n.return()}finally{if(a)throw r}}this.$http(""+i.l.MATERIELSAVEORDER_API,"POST",this.materielDataList).then(function(e){var a=e.data;0===a.code?t.$emit("updateOrderInfo",{orderId:a.orderId,orderNo:a.orderNo}):t.$message.error(a.msg||"申请订单失败，请稍后尝试")}).catch(function(t){console.log("catch data::",t)})}},saveMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){void 0!==t.status&&null!=t.status&&""!==t.status.trim()||(t.status="saved")}),this.$http(i.l.MATERIELSAVE_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},submitMateriel:function(t){var e=this;this.materielDataList.length>0?(this.materielDataList.forEach(function(t){"checked"!==t.status&&(t.status="submit")}),this.$http(i.l.MATERIELSUBMIT_API,"POST",this.materielDataList).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")}).catch(function(t){console.log("catch data::",t)})):t&&t("resolve")},validate:function(t){var e=!0,a=!1,r=void 0;try{for(var i,o=s()(this.materielDataList);!(e=(i=o.next()).done);e=!0){var n=i.value;if("0"===n.delFlag){if(null===n.dispatchMan||""===n.dispatchMan.trim())return this.$message.error("生产调度员不能为空"),!1;if(null===n.productCode||""===n.productCode.trim())return this.$message.error("生产物料不能为空"),!1;if(null===n.issueCode||""===n.issueCode.trim())return this.$message.error("发料料号不能为空"),!1;if(""===n.productWeight)return this.$message.error("生产数不能为空"),!1;if(null===n.issueBatch||""===n.issueBatch.trim())return this.$message.error("发料批次不能为空"),!1;if(n.issueBatch.trim().length>10)return this.$message.error("发料批次长度不能超过10"),!1;if(""===n.inStorageWeight)return this.$message.error("入库数不能为空"),!1;if(t&&"submit"===t&&(null===n.inStorageBatch||""===n.inStorageBatch.trim()))return this.$message.error("入库批次不能为空"),!1;if(n.inStorageBatch&&n.inStorageBatch.trim().length>10)return this.$message.error("入库批次长度不能超过10"),!1}}}catch(t){a=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw r}}return!0},getDictList:function(t){var e=this;this.dictListObj={};this.$http(""+i.k.PARAMETERSLIST_API,"POST",["PW_FEVOR","CM_material_prd","CM_material"]).then(function(t){var a=t.data;if(0===a.code){var r=!0,i=!1,o=void 0;try{for(var n,l=s()(a.dicList);!(r=(n=l.next()).done);r=!0){var c=n.value;e.$set(e.dictListObj,c.shname,c.prolist)}}catch(t){i=!0,o=t}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}}else e.$message.error(a.msg)}).catch(function(t){console.log("catch data::",t)})},getMaterielDataList:function(t){var e=this;this.materielDataList=[],this.readAudit=[];var a="";this.$http(""+i.l.MATERIELLIST_API,"POST",{orderId:t},!1,!1,!1).then(function(t){var r=t.data;if(0===r.code){e.materielDataList=r.wlist,e.readAudit=r.vrlist;var s=0,i=0,o=0,n=0;e.materielDataList.forEach(function(t){"noPass"===t.status?s+=1:"submit"===t.status?i+=1:"checked"===t.status?o+=1:"saved"===t.status&&(n+=1)}),s>0?a="noPass":i>0?a="submit":n>0?a="saved":o>0&&(a="checked")}else e.$message.error(r.msg)}).catch(function(t){console.log("catch data::",t)}).finally(function(){e.$emit("setAppyMaterielState",a)})},addNewRecord:function(){var t=this.materielDataList.filter(function(t){return"0"===t.delFlag}),e=t&&t.length>0?t[t.length-1]:null,a=Object(o.c)(new Date,"yyyy-MM-dd hh:mm:ss"),r=this.$store.state.user.realName;this.materielDataList.push({branWeight:e?e.branWeight:0,delFlag:"0",dispatchMan:this.dispatcherCode,gmCode:"02",granuleWeight:e?e.granuleWeight:0,inStorageBatch:e?e.inStorageBatch:"",inStorageWeight:e?e.inStorageWeight:0,issueBatch:e?e.issueBatch:"",issueCode:e?e.issueCode:"",issueName:e?e.issueName:"",issueWeight:e?e.issueWeight:0,productCode:e?e.productCode:"",productName:e?e.productName:"",productUnit:"KG",productWeight:e?e.productWeight:0,remark:e?e.remark:"",scrappedWeight:e?e.scrappedWeight:0,storageWeight:e?e.storageWeight:0,productDate:this.order&&this.order.productDate,factory:this.order&&this.order.factory,workShop:this.order&&this.order.workShop,productLine:this.order&&this.order.productLine,created:a,creator:r,changed:a,changer:r,orderId:this.order&&this.order.orderId,orderNo:this.order&&this.order.orderNo})},dellistbomS:function(t){t.delFlag="1"},rowDelFlag:function(t){var e=t.row;t.rowIndex;return"1"===e.delFlag?"rowDel":""},changeProductWeight:function(t){var e=!0,a=!1,r=void 0;try{for(var i,o=s()(this.materielDataList);!(e=(i=o.next()).done);e=!0){var n=i.value;n.recordId===t.recordId&&(n.inStorageWeight=n.productWeight)}}catch(t){a=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw r}}},changeProduct:function(t){var e=this.dictListObj.CM_material_prd.find(function(e){return e.code===t.productCode});e&&(t.productName=e.value)},changeIssue:function(t){var e=this.dictListObj.CM_material.find(function(e){return e.code===t.issueCode});e&&(t.issueName=e.value)}},computed:{enableSubmit:function(){return void 0===this.order||void 0===this.order.orderId||0===this.order.orderId.trim().length}},watch:{"order.productDate":function(t,e){this.materielDataList.forEach(function(e){"submit"!==e.status&&"checked"!==e.status&&(e.productDate=t)})},dispatcherCode:function(t,e){this.materielDataList.forEach(function(e){"submit"!==e.status&&"checked"!==e.status&&(e.dispatchMan=t)})}},components:{AuditLog:function(t){a.e(1).then(function(){var e=[a("bpq2")];t.apply(null,e)}.bind(this)).catch(a.oe)}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{attrs:{"body-style":"padding-top:10px;"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form",{ref:"form",attrs:{"label-width":"100px"}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"生产调度员"}},[a("el-select",{attrs:{size:"small","value-key":"dispatcherCode",placeholder:"请选择生产调度员",disabled:!t.isRedact||"submit"==t.appyMaterielState||"checked"==t.appyMaterielState},model:{value:t.dispatcherCode,callback:function(e){t.dispatcherCode=e},expression:"dispatcherCode"}},t._l(this.dictListObj.PW_FEVOR,function(t,e){return a("el-option",{key:e,attrs:{label:t.code,value:t.code}})}),1)],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"btn",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",size:"small",disabled:!t.isRedact||"submit"==t.appyMaterielState||"checked"==t.appyMaterielState},on:{click:t.addNewRecord}},[t._v("新增")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"primary",size:"small",disabled:!t.isRedact||!t.enableSubmit},on:{click:t.saveOrderMateriel}},[t._v("申请订单")])],1)])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-table",{ref:"table1",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{"header-row-class-name":"tableHead",data:t.materielDataList,"row-class-name":t.rowDelFlag,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"生产物料",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"productCode",placeholder:"请选择生产物料",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeProduct(e.row)}},model:{value:e.row.productCode,callback:function(a){t.$set(e.row,"productCode",a)},expression:"scope.row.productCode"}},t._l(t.dictListObj.CM_material_prd,function(t,e){return a("el-option",{key:e,attrs:{label:t.code+" "+t.value,value:t.code}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"生产数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},on:{input:function(a){return t.changeProductWeight(e.row)}},model:{value:e.row.productWeight,callback:function(a){t.$set(e.row,"productWeight",t._n(a))},expression:"scope.row.productWeight"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"60",label:"单位"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.productUnit="KG")+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"220",label:"发料料号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-select",{attrs:{"value-key":"issueCode",placeholder:"请选择发料料号",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small"},on:{change:function(a){return t.changeIssue(e.row)}},model:{value:e.row.issueCode,callback:function(a){t.$set(e.row,"issueCode",a)},expression:"scope.row.issueCode"}},t._l(t.dictListObj.CM_material,function(t,e){return a("el-option",{key:e,attrs:{label:t.code+" "+t.value,value:t.code}})}),1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"小麦数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.issueWeight=Number(e.row.branWeight)+Number(e.row.granuleWeight)+Number(e.row.scrappedWeight)+Number(e.row.inStorageWeight))+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"麸皮"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.branWeight,callback:function(a){t.$set(e.row,"branWeight",t._n(a))},expression:"scope.row.branWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"小颗粒"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.granuleWeight,callback:function(a){t.$set(e.row,"granuleWeight",t._n(a))},expression:"scope.row.granuleWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"报废小麦"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.scrappedWeight,callback:function(a){t.$set(e.row,"scrappedWeight",t._n(a))},expression:"scope.row.scrappedWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"发料批次"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{maxlength:"10",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.issueBatch,callback:function(a){t.$set(e.row,"issueBatch",a)},expression:"scope.row.issueBatch"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"入库数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"required"},[a("i",{staticClass:"reqI"},[t._v("*")]),t._v(" "),a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.inStorageWeight,callback:function(a){t.$set(e.row,"inStorageWeight",t._n(a))},expression:"scope.row.inStorageWeight"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"入库批次"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{maxlength:"10",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.inStorageBatch,callback:function(a){t.$set(e.row,"inStorageBatch",a)},expression:"scope.row.inStorageBatch"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"库存数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"number",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.storageWeight,callback:function(a){t.$set(e.row,"storageWeight",t._n(a))},expression:"scope.row.storageWeight"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"140",label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status,size:"small",placeholder:"手工录入"},model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"200",label:"生产订单"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.orderNo)+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small",disabled:!t.isRedact||"submit"===e.row.status||"checked"===e.row.status},on:{click:function(a){return t.dellistbomS(e.row)}}})]}}])})],1)],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("auditLog",{attrs:{tableData:t.readAudit}})],1)],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,l,!1,function(t){a("rx40")},"data-v-276158fa",null);e.default=c.exports},q2bi:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("//Fk"),s=a.n(r),i=a("P9l9"),o=a("Lna1"),n=a("x1Vl"),l=a("5ewr"),c=a("Lkpl"),d=a("l3K6"),u=a("Fv1n"),m={name:"dataEntryIndex",data:function(){return{orderStatus:"",isRedact:!1,orderNo:"",productDate:"",workShop:"",formHeader:{orderNo:this.$store.state.common.PWorder.orderNo,orderId:this.$store.state.common.PWorder.orderId,factory:this.$store.state.common.FWfactoryid,factoryName:this.$store.state.common.FWfactoryName,workShop:this.$store.state.common.FWworkShop,workShopName:this.$store.state.common.FWworkShopName,productLine:this.$store.state.common.PWorder.productLine,productLineName:this.$store.state.common.PWorder.productLineName,productDate:this.$store.state.common.PWorder.productDate.substring(0,4)+"-"+this.$store.state.common.PWorder.productDate.substring(4,6)+"-"+this.$store.state.common.PWorder.productDate.substring(6,8)},activeName:"1",enableOpt:!1,appyMaterielState:"",readyState:""}},mounted:function(){Object(o.f)(this.$),this.orderNo=this.PWorderNo,this.productDate=this.$store.state.common.PWorder.productDate,this.workShop=this.FWworkShop,this.GetOrderList()},methods:{tabClick:function(t){this.$refs.tabs.setCurrentName(t.name)},beforeLeave:function(t,e){return!(!this.enableOpt&&"1"!==t)||(this.$message({type:"error",message:"请申请订单之后操作",duration:1e3}),!1)},GetOrderList:function(){var t=this;this.isRedact=!1,this.orderNo&&this.$http(""+i.l.CINDEXORDERLIST_API,"POST",{workShop:this.workShop,productDate:this.productDate,orderNo:this.orderNo}).then(function(e){var a=e.data;t.formHeader=a.list[0],t.orderStatus=a.list[0].orderStatus,t.$refs.pwapplymateriel.getMaterielDataList(t.formHeader.orderId),t.$refs.pwapplymateriel.getDictList(t.formHeader),t.$refs.pwtime.GetPwTimeList()})},OrderUpdate:function(t,e){var a=this,r=0;this.$refs.pwapplymateriel.materielDataList.forEach(function(t){r+=parseInt(t.inStorageWeight)}),this.formHeader.orderStatus=t,this.formHeader.countOutputUnit="KG",this.formHeader.countOutput=r+"",this.formHeader.realOutput=r+"",this.formHeader.expAllDate=this.$refs.excrecord.ExcNum,this.$http(""+i.l.WHTORDERUPDATE_API,"POST",this.formHeader).then(function(t){var r=t.data;0===r.code||a.$message.error("保存表头"+r.msg),e&&e("resolve")})},SubmitForm:function(){var t=this;this.$confirm("确认提交该订单, 是否继续?","提交订单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.savedOrSubmitForm("submit")})},savedOrSubmitForm:function(t){var e=this;if("submit"===t){if(!this.$refs.pwtime.timerul())return!1;if(!this.$refs.excrecord.excrul())return!1;if(!this.$refs.pwapplymateriel.validate("submit"))return!1}var a=this,r=new s.a(function(e,r){a.OrderUpdate(t,e)}),i=new s.a(function(r,s){a.$refs.excrecord.saveOrSubmitExc(e.formHeader.orderId,t,r)}),o=new s.a(function(r,s){a.$refs.textrecord.UpdateText(e.formHeader,t,r)}),n=new s.a(function(e,r){a.$refs.pwtime.PwTimeUpdate(t,e,r)});if("submit"===t){s.a.all([r,i,o,n]).then(function(){var t=new s.a(function(t,e){a.$refs.pwapplymateriel.submitMateriel(t)}),e=new s.a(function(t,e){a.Timeupdate(t)});s.a.all([t,e]).then(function(){a.GetOrderList(),a.$message.success("提交成功")})})}else{var l=new s.a(function(t,e){a.$refs.pwapplymateriel.saveMateriel(t)});s.a.all([r,i,l,o,n]).then(function(){a.GetOrderList(),a.$message.success("保存成功")})}},Timeupdate:function(t){var e=this;this.$http(i.l.PWMATERIELTIMESUBMIT_API,"POST",[this.$refs.pwtime.pwTimeDate[0],{orderId:this.formHeader.orderId,outputUnit:this.formHeader.outputUnit,realOutput:this.formHeader.realOutput,countOutput:this.formHeader.countOutput,countOutputUnit:this.formHeader.countOutputUnit,productDate:this.formHeader.productDate}]).then(function(a){var r=a.data;0===r.code||e.$message.error(r.msg),t&&t("resolve")})},updateOrderInfo:function(t){this.orderNo=t.orderNo,this.PWorderNo=t.orderNo,this.PWorderId=t.orderId},updateProductDate:function(t){if(t){var e=t.replace(/-/g,"");this.productDate=e,this.PWproductDate=e}},setAppyMaterielState:function(t){this.appyMaterielState=t,this.$refs.tabs.handleTabClick(this.$refs.tabs.panes[parseInt(this.$refs.tabs.currentName)-1])},SetReadyStatus:function(t){this.readyState=t,this.$refs.tabs.handleTabClick(this.$refs.tabs.panes[parseInt(this.$refs.tabs.currentName)-1])}},watch:{orderNo:function(t,e){t&&(this.enableOpt=!0),this.GetOrderList()}},computed:{PWorderNo:{get:function(){return this.$store.state.common.PWorder.orderNo},set:function(t){this.$store.commit("common/updatePWorderNo",t)}},PWorderId:{get:function(){return this.$store.state.common.PWorder.orderId},set:function(t){this.$store.commit("common/updatePWorderId",t)}},FWworkShop:{get:function(){return this.$store.state.common.FWworkShop},set:function(t){this.$store.commit("common/updateFWWorkShop",t)}},PWproductDate:{get:function(){return this.$store.state.common.PWorder.productDate},set:function(t){this.$store.commit("common/updatePWproductDate",t)}}},components:{FormHeader:n.default,ExcRecord:l.default,TextRecord:u.default,PwTime:c.default,PwApplyMateriel:d.default}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-col",[a("div",{staticClass:"main"},[a("el-card",{staticClass:"searchCard newCard",staticStyle:{margin:"0"}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:21}},[a("form-header",{attrs:{formHeader:t.formHeader,isRedact:t.isRedact},on:{updateProductDateCallback:t.updateProductDate}})],1),t._v(" "),a("el-col",{attrs:{span:3}},[a("div",{staticStyle:{float:"right","line-height":"31px","font-size":"14px"}},[a("div",{staticStyle:{float:"left"}},[a("span",{staticClass:"point",style:{background:"noPass"===t.orderStatus?"red":"#7ED321"}}),t._v("订单状态：\n            ")]),t._v(" "),a("span",{style:{color:"noPass"===t.orderStatus?"red":""}},[t._v(t._s("noPass"===t.orderStatus?"审核不通过":"saved"===t.orderStatus?"已保存":"submit"===t.orderStatus?"已提交":"checked"===t.orderStatus?"通过":"已同步"===t.orderStatus?"未录入":t.orderStatus))])])])],1),t._v(" "),a("el-row",{staticClass:"buttonCss",staticStyle:{"text-align":"right"}},[[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.$router.push({path:"/DataEntry-FryWheat-index"})}}},[t._v("返回")]),t._v(" "),"submit"!==t.orderStatus&&"checked"!==t.orderStatus&&t.isAuth("sys:whtPwMaterial:update")?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.isRedact=!t.isRedact}}},[t._v(t._s(t.isRedact?"取消":"编辑"))]):t._e()],t._v(" "),t.isRedact&&t.enableOpt?[t.isAuth("sys:whtPwMaterial:update")?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.savedOrSubmitForm("saved")}}},[t._v("保存")]):t._e(),t._v(" "),t.isAuth("sys:whtPwMaterial:update")?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.SubmitForm}},[t._v("提交")]):t._e()]:t._e()],2),t._v(" "),a("div",{staticClass:"toggleSearchBottom"},[a("i",{staticClass:"el-icon-caret-top"})])],1)],1),t._v(" "),a("div",{staticClass:"main",staticStyle:{"padding-top":"0px"}},[a("div",{staticClass:"tableCard"},[a("div",{staticClass:"toggleSearchTop",staticStyle:{"background-color":"white","margin-bottom":"8px",position:"relative","border-radius":"5px"}},[a("i",{staticClass:"el-icon-caret-bottom"})]),t._v(" "),a("el-tabs",{ref:"tabs",staticClass:"NewDaatTtabs",attrs:{id:"DaatTtabs","before-leave":t.beforeLeave,type:"border-card"},on:{"tab-click":t.tabClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"1"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"noPass"===this.appyMaterielState?"不通过":"saved"===this.appyMaterielState?"已保存":"submit"===this.appyMaterielState?"已提交":"checked"===this.appyMaterielState?"通过":"未录入",placement:"top-start"}},[a("el-button",{style:{color:"noPass"===this.appyMaterielState?"red":""}},[t._v("物料领用")])],1)],1),t._v(" "),a("pw-apply-materiel",{ref:"pwapplymateriel",attrs:{isRedact:t.isRedact,order:t.formHeader,appyMaterielState:t.appyMaterielState},on:{updateOrderInfo:t.updateOrderInfo,setAppyMaterielState:t.setAppyMaterielState}})],1),t._v(" "),a("el-tab-pane",{attrs:{name:"2"}},[a("span",{staticClass:"spanview",attrs:{slot:"label"},slot:"label"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"noPass"===this.readyState?"不通过":"saved"===this.readyState?"已保存":"submit"===this.readyState?"已提交":"checked"===this.readyState?"通过":"未录入",placement:"top-start"}},[a("el-button",{style:{color:"noPass"===t.readyState?"red":""}},[t._v("工时录入")])],1)],1),t._v(" "),a("pw-time",{ref:"pwtime",attrs:{isRedact:t.isRedact,order:t.formHeader},on:{SetReadyStatus:t.SetReadyStatus}})],1),t._v(" "),a("el-tab-pane",{attrs:{name:"3"}},[a("span",{staticClass:"spanview",attrs:{slot:"label"},slot:"label"},[a("el-button",[t._v("异常记录")])],1),t._v(" "),a("exc-record",{ref:"excrecord",attrs:{isRedact:t.isRedact}})],1),t._v(" "),a("el-tab-pane",{attrs:{name:"4"}},[a("span",{staticClass:"spanview",attrs:{slot:"label"},slot:"label"},[a("el-button",[t._v("文本记录")])],1),t._v(" "),a("text-record",{ref:"textrecord",attrs:{isRedact:t.isRedact}})],1)],1)],1)])])},staticRenderFns:[]};var h=a("C7Lr")(m,p,!1,function(t){a("+AXQ")},null,null);e.default=h.exports},rx40:function(t,e){}});
//# sourceMappingURL=17.3622e689342251528f6a.js.map